<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>勉強記録カレンダー</title>
    <link rel="stylesheet" href="../static/study_history.css">
</head>
<body>
    <div class="container">
        <!-- 左側のカレンダー -->
        <div class="calendar-container">
            <h1>📅 勉強記録</h1>
            <div class="calendar-header">
                <button id="prev-month">◀</button>
                <h2 id="current-month"></h2>
                <button id="next-month">▶</button>
            </div>
            <div class="weekday-row">
                <div class="weekday">日</div>
                <div class="weekday">月</div>
                <div class="weekday">火</div>
                <div class="weekday">水</div>
                <div class="weekday">木</div>
                <div class="weekday">金</div>
                <div class="weekday">土</div>
            </div>
            <div id="calendar"></div>
        </div>

        <!-- 右側の勉強記録入力フォーム -->
        <div class="study-form-container">
            <h2 id="selected-date">日付を選択</h2>
            <label>科目:</label>
            <input type="text" id="study-subject" placeholder="例: 数学, 英語, プログラミング...">
            <label>勉強時間（時間）:</label>
            <input type="number" id="study-hours" min="0" step="0.5" placeholder="例: 2">
            <button id="add-study">追加</button>
            <h3>📜 記録一覧</h3>
            <ul id="study-list"></ul>
        </div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const calendar = document.getElementById("calendar");
            const currentMonth = document.getElementById("current-month");
            const prevMonthBtn = document.getElementById("prev-month");
            const nextMonthBtn = document.getElementById("next-month");

            const selectedDateText = document.getElementById("selected-date");
            const studySubjectInput = document.getElementById("study-subject");
            const studyHoursInput = document.getElementById("study-hours");
            const addStudyButton = document.getElementById("add-study");
            const studyList = document.getElementById("study-list");

            let today = new Date();
            let currentYear = today.getFullYear();
            let currentMonthIndex = today.getMonth();
            let selectedDate = null;
            let studyRecords = {};

            function renderCalendar(year, month) {
                calendar.innerHTML = ""; 
                currentMonth.innerText = `${year}年 ${month + 1}月`;

                const firstDay = new Date(year, month, 1).getDay();
                const daysInMonth = new Date(year, month + 1, 0).getDate();

                for (let i = 0; i < firstDay; i++) {
                    let emptyDiv = document.createElement("div");
                    emptyDiv.classList.add("empty-day");
                    calendar.appendChild(emptyDiv);
                }

                for (let i = 1; i <= daysInMonth; i++) {
                    let dayDiv = document.createElement("div");
                    dayDiv.classList.add("calendar-day");
                    dayDiv.innerText = i;

                    dayDiv.addEventListener("click", () => {
                        selectedDate = `${year}-${month + 1}-${i}`;
                        selectedDateText.innerText = `${year}年${month + 1}月${i}日 の勉強記録`;

                        updateStudyList();
                    });

                    calendar.appendChild(dayDiv);
                }
            }

            function updateStudyList() {
                studyList.innerHTML = "";
                if (selectedDate && studyRecords[selectedDate]) {
                    studyRecords[selectedDate].forEach(record => {
                        let li = document.createElement("li");
                        li.innerHTML = `<strong>${record.subject}</strong>: ${record.hours}時間`;
                        studyList.appendChild(li);
                    });
                }
            }

            addStudyButton.addEventListener("click", () => {
                if (!selectedDate) {
                    alert("日付を選択してください！");
                    return;
                }

                let subject = studySubjectInput.value.trim();
                let hours = studyHoursInput.value.trim();

                if (subject === "" || hours === "") {
                    alert("科目と勉強時間を入力してください！");
                    return;
                }

                if (!studyRecords[selectedDate]) {
                    studyRecords[selectedDate] = [];
                }
                studyRecords[selectedDate].push({ subject, hours });

                studySubjectInput.value = "";
                studyHoursInput.value = "";

                updateStudyList();
            });

            prevMonthBtn.addEventListener("click", function () {
                currentMonthIndex--;
                if (currentMonthIndex < 0) {
                    currentMonthIndex = 11;
                    currentYear--;
                }
                renderCalendar(currentYear, currentMonthIndex);
            });

            nextMonthBtn.addEventListener("click", function () {
                currentMonthIndex++;
                if (currentMonthIndex > 11) {
                    currentMonthIndex = 0;
                    currentYear++;
                }
                renderCalendar(currentYear, currentMonthIndex);
            });

            renderCalendar(currentYear, currentMonthIndex);
        });
    </script>
</body>
</html>
