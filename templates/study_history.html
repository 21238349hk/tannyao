<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å‹‰å¼·è¨˜éŒ²ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼</title>
    <link rel="stylesheet" href="../static/study_history.css">
</head>
<body>
    <div class="container">
        <!-- å·¦å´ã®ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ -->
        <div class="calendar-container">
            <h1>ğŸ“… å‹‰å¼·è¨˜éŒ²</h1>
            <div class="calendar-header">
                <button id="prev-month">â—€</button>
                <h2 id="current-month"></h2>
                <button id="next-month">â–¶</button>
            </div>
            <div class="weekday-row">
                <div class="weekday">æ—¥</div>
                <div class="weekday">æœˆ</div>
                <div class="weekday">ç«</div>
                <div class="weekday">æ°´</div>
                <div class="weekday">æœ¨</div>
                <div class="weekday">é‡‘</div>
                <div class="weekday">åœŸ</div>
            </div>
            <div id="calendar"></div>
        </div>

        <!-- å³å´ã®å‹‰å¼·è¨˜éŒ²å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ  -->
        <div class="study-form-container">
            <h2 id="selected-date">æ—¥ä»˜ã‚’é¸æŠ</h2>
            <label>ç§‘ç›®:</label>
            <input type="text" id="study-subject" placeholder="ä¾‹: æ•°å­¦, è‹±èª, ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°...">
            <label>å‹‰å¼·æ™‚é–“ï¼ˆæ™‚é–“ï¼‰:</label>
            <input type="number" id="study-hours" min="0" step="0.5" placeholder="ä¾‹: 2">
            <button id="add-study">è¿½åŠ </button>
            <h3>ğŸ“œ è¨˜éŒ²ä¸€è¦§</h3>
            <ul id="study-list"></ul>
        </div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const calendar = document.getElementById("calendar");
            const currentMonth = document.getElementById("current-month");
            const prevMonthBtn = document.getElementById("prev-month");
            const nextMonthBtn = document.getElementById("next-month");

            const selectedDateText = document.getElementById("selected-date");
            const studySubjectInput = document.getElementById("study-subject");
            const studyHoursInput = document.getElementById("study-hours");
            const addStudyButton = document.getElementById("add-study");
            const studyList = document.getElementById("study-list");

            let today = new Date();
            let currentYear = today.getFullYear();
            let currentMonthIndex = today.getMonth();
            let selectedDate = null;
            let studyRecords = {};

            function renderCalendar(year, month) {
                calendar.innerHTML = ""; 
                currentMonth.innerText = `${year}å¹´ ${month + 1}æœˆ`;

                const firstDay = new Date(year, month, 1).getDay();
                const daysInMonth = new Date(year, month + 1, 0).getDate();

                for (let i = 0; i < firstDay; i++) {
                    let emptyDiv = document.createElement("div");
                    emptyDiv.classList.add("empty-day");
                    calendar.appendChild(emptyDiv);
                }

                for (let i = 1; i <= daysInMonth; i++) {
                    let dayDiv = document.createElement("div");
                    dayDiv.classList.add("calendar-day");
                    dayDiv.innerText = i;

                    dayDiv.addEventListener("click", () => {
                        selectedDate = `${year}-${month + 1}-${i}`;
                        selectedDateText.innerText = `${year}å¹´${month + 1}æœˆ${i}æ—¥ ã®å‹‰å¼·è¨˜éŒ²`;

                        updateStudyList();
                    });

                    calendar.appendChild(dayDiv);
                }
            }

            function updateStudyList() {
                studyList.innerHTML = "";
                if (selectedDate && studyRecords[selectedDate]) {
                    studyRecords[selectedDate].forEach(record => {
                        let li = document.createElement("li");
                        li.innerHTML = `<strong>${record.subject}</strong>: ${record.hours}æ™‚é–“`;
                        studyList.appendChild(li);
                    });
                }
            }

            addStudyButton.addEventListener("click", () => {
                if (!selectedDate) {
                    alert("æ—¥ä»˜ã‚’é¸æŠã—ã¦ãã ã•ã„ï¼");
                    return;
                }

                let subject = studySubjectInput.value.trim();
                let hours = studyHoursInput.value.trim();

                if (subject === "" || hours === "") {
                    alert("ç§‘ç›®ã¨å‹‰å¼·æ™‚é–“ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼");
                    return;
                }

                if (!studyRecords[selectedDate]) {
                    studyRecords[selectedDate] = [];
                }
                studyRecords[selectedDate].push({ subject, hours });

                studySubjectInput.value = "";
                studyHoursInput.value = "";

                updateStudyList();
            });

            prevMonthBtn.addEventListener("click", function () {
                currentMonthIndex--;
                if (currentMonthIndex < 0) {
                    currentMonthIndex = 11;
                    currentYear--;
                }
                renderCalendar(currentYear, currentMonthIndex);
            });

            nextMonthBtn.addEventListener("click", function () {
                currentMonthIndex++;
                if (currentMonthIndex > 11) {
                    currentMonthIndex = 0;
                    currentYear++;
                }
                renderCalendar(currentYear, currentMonthIndex);
            });

            renderCalendar(currentYear, currentMonthIndex);
        });
    </script>
</body>
</html>
